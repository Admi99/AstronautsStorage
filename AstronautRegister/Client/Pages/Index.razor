@page "/"
@using AstronautRegister.Shared
@using AstronautRegister.Client.Components

@inject HttpClient Http

<PageTitle>Astronaut register</PageTitle>

<Modal @ref="Modal"></Modal>

<Page>
    <h1 class="text-xl">Add astronaut</h1>
    <AstronautsEditForm Astronaut="@Astronaut" OnClick="@AddAstronaut"/>
    <AstronautsTable Astronauts="@_astronauts" OnClick="@DeleteAstronaut"/>
    <button @onclick="() => Modal.Open()">Open Modal</button>
</Page>
@* npx tailwindcss -i ./Styles/app.css -o ./wwwroot/app.css --watch *@
@code{

    private Astronaut Astronaut { get; set; } = CreateAstronaut();

    private readonly List<Astronaut> _astronauts = new();
    
    private Modal Modal { get; set; }

    protected override async Task OnInitializedAsync()
    {
        _astronauts.Clear();
        var result = await Http.GetFromJsonAsync<IEnumerable<Astronaut>>("Astronaut");
        _astronauts.AddRange(result ?? Array.Empty<Astronaut>());
    }

    private static Astronaut CreateAstronaut()
        => new()
        {
            DateOfBirth = DateTimeOffset.Now
        };

    private async Task DeleteAstronaut(Astronaut astronaut)
    {
        _astronauts.Remove(astronaut);
        await Http.DeleteAsync($"Astronaut/del/{astronaut.Id}");
    }
    
    private async Task AddAstronaut()
    {
        _astronauts.Add(Astronaut);
        await Http.PostAsJsonAsync("Astronaut", Astronaut);

        Astronaut = CreateAstronaut();
    }
}